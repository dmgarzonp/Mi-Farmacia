<div class="p-6 space-y-6 animate-fade-in">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-black text-slate-800 tracking-tight uppercase">Control de Caja y Arqueo</h1>
      <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1">Gestión de turnos y flujo de efectivo</p>
    </div>
    
    <div *ngIf="sesionActiva()" class="flex items-center gap-4 bg-emerald-50 px-6 py-3 rounded-2xl border border-emerald-100">
      <div class="w-10 h-10 bg-emerald-500 text-white rounded-xl flex items-center justify-center shadow-lg shadow-emerald-200">
        <span class="w-5 h-5" [innerHTML]="icons.CHECK | safeHtml"></span>
      </div>
      <div>
        <p class="text-[10px] font-black text-emerald-800 uppercase tracking-widest">Turno Abierto</p>
        <p class="text-xs font-bold text-emerald-600">Desde: {{ sesionActiva()?.fechaApertura }}</p>
      </div>
    </div>
  </div>

  <!-- Estado de Caja: Cerrada -->
  <div *ngIf="!sesionActiva()" class="bg-white rounded-[2.5rem] border border-slate-100 shadow-premium p-12 text-center space-y-8 animate-slide-up">
    <div class="w-24 h-24 bg-slate-50 text-slate-200 rounded-[2rem] flex items-center justify-center mx-auto">
      <span class="w-12 h-12" [innerHTML]="icons.SAVE | safeHtml"></span>
    </div>
    <div class="max-w-md mx-auto">
      <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tight">No hay un turno activo</h2>
      <p class="text-sm font-medium text-slate-500 mt-2">Para comenzar a realizar ventas, debe abrir un nuevo turno de caja declarando su fondo inicial.</p>
    </div>
    <app-button 
      variant="primary" 
      size="lg" 
      iconNameLeft="ADD" 
      (clicked)="showModalApertura.set(true)"
      class="inline-block"
    >
      Abrir Nueva Caja
    </app-button>
  </div>

  <!-- Estado de Caja: Abierta -->
  <div *ngIf="sesionActiva()" class="grid grid-cols-1 lg:grid-cols-3 gap-6 animate-slide-up">
    
    <!-- Columna 1: Resumen del Sistema -->
    <div class="lg:col-span-1 space-y-6">
      <div class="bg-primary-900 text-white rounded-[2.5rem] p-8 shadow-premium relative overflow-hidden group">
        <div class="absolute -right-10 -top-10 w-48 h-48 bg-primary-500/10 rounded-full blur-3xl group-hover:bg-primary-500/20 transition-all duration-1000"></div>
        
        <h3 class="text-[10px] font-black text-primary-300 uppercase tracking-[0.3em] mb-6 relative z-10">Balance del Sistema</h3>
        
        <div class="space-y-4 relative z-10">
          <div class="flex justify-between items-center text-primary-100/60 text-xs font-bold uppercase tracking-widest">
            <span>Fondo Inicial</span>
            <span>{{ sesionActiva()?.montoInicial | currencyFormat }}</span>
          </div>
          <div class="flex justify-between items-center text-primary-100/60 text-xs font-bold uppercase tracking-widest">
            <span>(+) Ventas Efectivo</span>
            <span>{{ totalVentasEfectivo | currencyFormat }}</span>
          </div>
          <div class="pt-6 border-t border-white/10">
            <span class="text-[10px] font-black text-primary-300 uppercase tracking-[0.3em]">Efectivo Esperado</span>
            <div class="text-4xl font-black text-white mt-2 tracking-tighter">{{ montoEsperadoTotal | currencyFormat }}</div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-[2rem] border border-slate-100 p-6 shadow-sm space-y-4">
        <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Otros Métodos (Saldos Digitales)</h3>
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-indigo-50 text-indigo-500 rounded-lg flex items-center justify-center">
              <span class="w-4 h-4" [innerHTML]="icons.CLIPBOARD | safeHtml"></span>
            </div>
            <span class="text-xs font-bold text-slate-600 uppercase tracking-widest">Ventas Tarjeta</span>
          </div>
          <span class="text-sm font-black text-slate-800">{{ totalVentasTarjeta | currencyFormat }}</span>
        </div>
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-50 text-blue-500 rounded-lg flex items-center justify-center">
              <span class="w-4 h-4" [innerHTML]="icons.VIEW | safeHtml"></span>
            </div>
            <span class="text-xs font-bold text-slate-600 uppercase tracking-widest">Ventas Transferencia</span>
          </div>
          <span class="text-sm font-black text-slate-800">{{ totalVentasTransferencia | currencyFormat }}</span>
        </div>
      </div>
    </div>

    <!-- Columna 2-3: Formulario de Arqueo -->
    <div class="lg:col-span-2 bg-white rounded-[2.5rem] border border-slate-100 shadow-premium p-8 flex flex-col">
      <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-8">Arqueo Físico (Conteo de Dinero)</h3>
      
      <div class="flex-1 space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary-300 transition-colors">
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Efectivo en Caja</label>
            <div class="flex items-center gap-3">
              <span class="text-2xl font-black text-slate-300">$</span>
              <input type="number" [(ngModel)]="montoEfectivo" class="w-full bg-transparent text-2xl font-black text-slate-800 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-indigo-300 transition-colors">
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Vouchers Tarjeta</label>
            <div class="flex items-center gap-3">
              <span class="text-2xl font-black text-slate-300">$</span>
              <input type="number" [(ngModel)]="montoTarjeta" class="w-full bg-transparent text-2xl font-black text-slate-800 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-blue-300 transition-colors">
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Suma Transferencias</label>
            <div class="flex items-center gap-3">
              <span class="text-2xl font-black text-slate-300">$</span>
              <input type="number" [(ngModel)]="montoTransferencia" class="w-full bg-transparent text-2xl font-black text-slate-800 focus:outline-none" placeholder="0.00">
            </div>
          </div>
        </div>

        <div class="space-y-4">
          <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">Observaciones del Turno</label>
          <textarea 
            [(ngModel)]="observaciones"
            rows="3"
            class="w-full bg-slate-50 border border-slate-100 rounded-3xl px-6 py-4 text-sm font-medium text-slate-700 focus:outline-none focus:ring-2 focus:ring-primary-500/20 transition-all"
            placeholder="Novedades, billetes falsos detectados, gastos autorizados, etc..."
          ></textarea>
        </div>
      </div>

      <div class="pt-8 mt-8 border-t border-slate-100 flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div [class]="(montoEfectivo() - montoEsperadoTotal) >= 0 ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'" 
               class="px-4 py-2 rounded-xl border border-current text-[10px] font-black uppercase tracking-widest">
            Diferencia Efectivo: {{ (montoEfectivo() - montoEsperadoTotal) | currencyFormat }}
          </div>
        </div>
        <app-button 
          variant="primary" 
          size="lg" 
          iconNameLeft="CHECK" 
          [loading]="loading()"
          (clicked)="realizarCierre()"
        >
          Cerrar Caja y Terminar Turno
        </app-button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Apertura de Caja -->
<app-modal
  [isOpen]="showModalApertura()"
  (closed)="showModalApertura.set(false)"
  size="md"
>
  <div class="p-8">
    <div class="flex items-center gap-4 mb-8">
      <div class="w-12 h-12 bg-emerald-600 text-white rounded-2xl flex items-center justify-center shadow-lg shadow-emerald-200">
        <span class="w-6 h-6" [innerHTML]="icons.SAVE | safeHtml"></span>
      </div>
      <div>
        <h2 class="text-2xl font-black text-slate-800 tracking-tight uppercase">Apertura de Caja</h2>
        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">Declare su fondo inicial para transacciones</p>
      </div>
    </div>

    <div class="space-y-6">
      <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100">
        <label class="block text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">Monto Inicial (Efectivo)</label>
        <div class="flex items-center gap-4">
          <span class="text-3xl font-black text-slate-300">$</span>
          <input 
            type="number" 
            [(ngModel)]="montoApertura"
            class="flex-1 bg-transparent text-4xl font-black text-slate-800 focus:outline-none placeholder:text-slate-200"
            placeholder="0.00"
            step="0.01"
            min="0"
          />
        </div>
      </div>

      <div class="bg-amber-50 border border-amber-100 p-4 rounded-2xl flex gap-4">
        <span class="w-5 h-5 text-amber-500 shrink-0" [innerHTML]="icons.SEARCH | safeHtml"></span>
        <p class="text-[10px] font-medium text-amber-700 leading-relaxed uppercase">
          Al abrir caja, todas las ventas que realice quedarán vinculadas a este turno para el arqueo final.
        </p>
      </div>

      <div class="flex gap-3">
        <app-button variant="secondary" [fullWidth]="true" (clicked)="showModalApertura.set(false)">Cancelar</app-button>
        <app-button variant="primary" [fullWidth]="true" (clicked)="abrirCaja()">Abrir Turno</app-button>
      </div>
    </div>
  </div>
</app-modal>

